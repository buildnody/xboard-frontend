server {
    listen 80;
    server_name localhost;

    root /usr/share/nginx/html;
    index index.html;

    # 1. 前端页面路由配置
    location / {
        try_files $uri $uri/ /index.html;
        
        # 安全响应头 (CSP)
        # default-src 'self': 只允许加载本站资源
        # script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com: 允许本站脚本、内联脚本和 Tailwind CDN
        # style-src 'self' 'unsafe-inline' https://fonts.googleapis.com: 允许本站样式、内联样式和 Google 字体
        # img-src 'self' data: https:: 允许本站图片、Base64 和所有 HTTPS 图片
        # connect-src 'self' https://your-backend-api.com: 允许本站 API 和 Xboard 后台
        add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https:; connect-src 'self' https://your-backend-api.com; frame-ancestors 'none';";
        
        add_header X-Frame-Options "SAMEORIGIN";
        add_header X-Content-Type-Options "nosniff";
        add_header X-XSS-Protection "1; mode=block";
        add_header Referrer-Policy "strict-origin-when-cross-origin";
    }

    # 2. 对接 Xboard 后台 (反向代理)
    location /api/v1/ {
        # [修改这里] 替换为你的 Xboard 后台域名
        proxy_pass https://your-backend-api.com/api/v1/; 
        proxy_ssl_server_name on;
        proxy_set_header Host your-backend-api.com;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header REMOTE-HOST $remote_addr;
        
        # 解决跨域问题 (CORS)
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization' always;
        
        if ($request_method = 'OPTIONS') {
            return 204;
        }
    }

    # 3. 静态资源缓存
    location ~* \.(?:ico|css|js|gif|jpe?g|png|woff2?|eot|otf|ttf|svg)$ {
        expires 30d;
        add_header Cache-Control "public";
    }

    # 4. 开启 Gzip 压缩
    gzip on;
    gzip_vary on;
    gzip_min_length 10240;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml application/javascript;
}
