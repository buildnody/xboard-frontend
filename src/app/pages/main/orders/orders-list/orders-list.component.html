<h1 class="text-3xl font-bold text-text-main mb-8">我的订单</h1>

<div class="bg-surface rounded-2xl shadow-neumorphic-raised overflow-hidden">
  @if (loading()) {
    <div class="flex justify-center items-center p-16">
      <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-accent-start"></div>
    </div>
  } @else if (error()) {
    <div class="p-8 text-center text-red-400">
      <p>{{ error() }}</p>
    </div>
  } @else if (orders().length === 0) {
     <div class="p-12 text-center text-text-muted">
      <div class="flex justify-center mb-6">
        <svg class="w-24 h-24 text-text-muted/40" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c.51 0 .962-.343 1.087-.835l.383-1.437M7.5 14.25L5.106 5.165A2.25 2.25 0 002.856 3H2.25m9.75 5.25l-2.25-2.25m0 0l-2.25 2.25M12 3v9.75m0 0c-2.046 0-3.87.62-5.408 1.692M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
      </div>
      <h3 class="text-xl font-semibold text-text-main">空空如也</h3>
      <p class="mt-2">您还没有任何订单记录。</p>
      <a routerLink="/app/plans" class="mt-8 inline-block py-2.5 px-6 rounded-xl font-semibold text-white bg-gradient-to-br from-accent-start to-accent-end shadow-neumorphic-raised hover:shadow-neumorphic-pressed active:shadow-neumorphic-sunken transition-all">前往商店</a>
    </div>
  } @else {
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-dark">
        <thead class="bg-dark/50">
          <tr>
            <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-text-muted uppercase tracking-wider">订单号</th>
            <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-text-muted uppercase tracking-wider">套餐</th>
            <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-text-muted uppercase tracking-wider">金额</th>
            <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-text-muted uppercase tracking-wider">状态</th>
            <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-text-muted uppercase tracking-wider">创建时间</th>
            <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-text-muted uppercase tracking-wider">操作</th>
          </tr>
        </thead>
        <tbody class="bg-surface divide-y divide-dark">
          @for (order of orders(); track order.trade_no) {
            <tr class="hover:bg-dark/20 transition-colors">
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-text-main font-mono">{{ order.trade_no }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-text-muted">{{ order.plan.name }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-text-muted">¥{{ order.total_amount / 100 }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full text-white/90" [class]="order.statusClass">
                  {{ order.statusText }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-text-muted">{{ order.created_at | date:'yyyy-MM-dd HH:mm' }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-5">
                  @if (order.status === 0) {
                    <button (click)="handleViewPendingOrder(order.trade_no)" [disabled]="processingOrder() === order.trade_no" class="text-accent-start hover:text-accent-end transition-colors disabled:text-gray-500 disabled:cursor-wait">
                      查看
                    </button>
                  } @else {
                    <a [routerLink]="['/app/order-status', order.trade_no]" class="text-accent-start hover:text-accent-end transition-colors">查看</a>
                  }
                  @if (order.status === 0) {
                    <button (click)="cancelOrder(order.trade_no)" [disabled]="processingOrder() === order.trade_no" class="text-red-400 hover:text-red-300 disabled:text-gray-500 disabled:cursor-wait transition-colors">
                        取消
                    </button>
                  }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>